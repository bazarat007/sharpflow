<!DOCTYPE html>
<html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>SharpFlow</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#060d14;color:#c5d0de;font-family:'DM Sans',-apple-system,system-ui,sans-serif}
@keyframes fadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#060d14}::-webkit-scrollbar-thumb{background:#1a2a3a;border-radius:3px}
.mono{font-family:'JetBrains Mono',monospace}
</style>
</head><body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useCallback}=React;

function useApi(ep,interval=60000){
  const[data,setData]=useState(null);
  const fd=useCallback(async()=>{try{const r=await fetch(ep);setData(await r.json())}catch(e){}},[ep]);
  useEffect(()=>{fd();const id=setInterval(fd,interval);return()=>clearInterval(id)},[fd,interval]);
  return data;
}

const TC={sharp:"#00f5a0",average:"#8a9bb5",dull:"#f54242"};
const TL={sharp:"\ud83d\udcca SHARP",average:"\u2696\ufe0f AVG",dull:"\u274c DULL"};
const CE={sports:"\ud83c\udfc0",politics:"\ud83c\udfdb\ufe0f",other:"\ud83d\udcca"};

function Badge({tier}){
  const c=TC[tier]||"#5a7a9a";
  return <span style={{background:c+"1e",color:c,padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700,whiteSpace:"nowrap"}}>{TL[tier]||tier}</span>
}

function Stat({value,label,color="#5a7a9a"}){
  return <div style={{background:"#0a1018",border:"1px solid #1a2a3a",borderRadius:8,padding:"12px 8px",textAlign:"center",minWidth:80}}>
    <div className="mono" style={{fontSize:22,fontWeight:800,color}}>{value}</div>
    <div style={{fontSize:9,color:"#3a4a5a",letterSpacing:1.5,marginTop:4,textTransform:"uppercase"}}>{label}</div>
  </div>
}

function Bar({pct,h=6,o=1}){
  const w=Math.max(2,Math.round(pct*100));
  return <div style={{display:"flex",height:h,borderRadius:h/2,overflow:"hidden",background:"#111b26"}}>
    <div style={{width:w+"%",background:`rgba(0,245,160,${o})`,transition:"width .5s"}}/>
    <div style={{width:(100-w)+"%",background:`rgba(245,66,66,${o})`,transition:"width .5s"}}/>
  </div>
}

function WalletRow({w,rank}){
  const[open,setOpen]=useState(false);
  const[live,setLive]=useState(null);
  const[ld,setLd]=useState(false);
  const c=TC[w.tier]||"#5a7a9a",pc=w.total_pnl>=0?"#00f5a0":"#f54242";
  const ps=w.total_pnl>=0?"+":"",pf=Math.abs(w.total_pnl)>=1e6?`$${(w.total_pnl/1e6).toFixed(1)}M`:`$${Math.abs(w.total_pnl).toLocaleString("en",{maximumFractionDigits:0})}`;

  const click=async()=>{
    if(!open&&!live){setLd(true);try{setLive(await(await fetch(`/api/wallets/${w.wallet}/live`)).json())}catch(e){}setLd(false)}
    setOpen(!open)
  };

  return <div style={{borderBottom:"1px solid #111b26"}}>
    <div onClick={click} style={{display:"grid",gridTemplateColumns:"36px 1fr 80px 52px 60px 52px 70px",alignItems:"center",padding:"10px 8px",cursor:"pointer"}}
      onMouseEnter={e=>e.currentTarget.style.background="#0d1520"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
      <span className="mono" style={{color:"#3a4a5a",fontSize:12}}>#{rank}</span>
      <div style={{minWidth:0}}>
        <div style={{fontSize:13,fontWeight:600,color:"#e8edf2",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{w.display_name}</div>
        <div style={{display:"flex",alignItems:"center",gap:6,marginTop:2}}>
          <Badge tier={w.tier}/>
          <span className="mono" style={{fontSize:10,color:"#2a3a4a"}}>{w.wallet.slice(0,6)}...{w.wallet.slice(-4)}</span>
        </div>
      </div>
      <div className="mono" style={{textAlign:"right",fontSize:18,fontWeight:800,color:c}}>{(w.sharpness_score*100).toFixed(0)}</div>
      <div className="mono" style={{textAlign:"right",fontSize:12,color:"#00d4ff"}}>{w.avg_clv>=0?"+":""}{w.avg_clv.toFixed(3)}</div>
      <div className="mono" style={{textAlign:"right",fontSize:12}}>{(w.win_rate*100).toFixed(0)}%</div>
      <div style={{textAlign:"right",fontSize:11,color:"#5a7a9a"}}>{w.distinct_markets}</div>
      <div className="mono" style={{textAlign:"right",fontSize:12,color:pc}}>{ps}{pf}</div>
    </div>
    {open&&<div style={{padding:"0 8px 16px 44px",animation:"fadeIn .2s ease"}}>
      <div style={{display:"flex",gap:12,marginBottom:12,flexWrap:"wrap"}}>
        {[{l:"CLV (25%)",v:w.clv_score?.toFixed(2),c:"#00d4ff"},{l:"Timing (25%)",v:w.timing_score?.toFixed(2),c:"#a855f7"},
          {l:"Consist (25%)",v:w.consistency_score?.toFixed(2),c:"#f5c842"},{l:"ROI (25%)",v:w.roi_score?.toFixed(2),c:"#00f5a0"}].map((s,i)=>
          <div key={i} style={{background:"#080e14",border:"1px solid #1a2a3a",borderRadius:6,padding:"6px 10px",textAlign:"center"}}>
            <div className="mono" style={{fontSize:14,fontWeight:700,color:s.c}}>{s.v}</div>
            <div style={{fontSize:9,color:"#3a4a5a",marginTop:2}}>{s.l}</div></div>)}
      </div>
      {w.category_scores&&Object.keys(w.category_scores).length>0&&<div style={{display:"flex",gap:6,marginBottom:12,flexWrap:"wrap"}}>
        {Object.entries(w.category_scores).map(([cat,cs])=>
          <div key={cat} style={{background:cs.tier==="sharp"?"rgba(0,245,160,.1)":"#080e14",border:`1px solid ${cs.tier==="sharp"?"#00f5a040":"#1a2a3a"}`,borderRadius:5,padding:"4px 8px",fontSize:10}}>
            <span>{CE[cat]||"\ud83d\udcca"} {cat}</span>
            <span className="mono" style={{marginLeft:6,fontWeight:700,color:cs.tier==="sharp"?"#00f5a0":cs.tier==="average"?"#8a9bb5":"#f54242"}}>{cs.tier.toUpperCase()}</span>
            <span style={{color:"#3a4a5a",marginLeft:4}}>{cs.markets}m {(cs.win_rate*100).toFixed(0)}%wr</span>
          </div>)}
      </div>}
      </div>
      {ld&&<div style={{color:"#3a4a5a",fontSize:12,padding:8}}>Loading...</div>}
      {live&&<>
        {live.positions?.length>0&&<div style={{marginBottom:12}}>
          <div style={{fontSize:10,color:"#5a7a9a",letterSpacing:1,marginBottom:6,fontWeight:700}}>POSITIONS ({live.position_count}) &middot; ${(live.total_position_value||0).toLocaleString("en",{maximumFractionDigits:0})}</div>
          {live.positions.slice(0,8).map((p,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 0",borderBottom:"1px solid #0d1520",fontSize:12}}>
            <span style={{color:"#c5d0de",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:8}}>{p.title?.slice(0,45)}</span>
            <span style={{color:p.outcome?.toLowerCase()==="yes"?"#00f5a0":"#f54242",fontWeight:700,width:32,textAlign:"center",fontSize:11}}>{p.outcome}</span>
            <span className="mono" style={{color:"#f5c842",width:60,textAlign:"right"}}>${(p.notional||0).toLocaleString("en",{maximumFractionDigits:0})}</span>
          </div>)}</div>}
        {live.recent_trades?.length>0&&<div>
          <div style={{fontSize:10,color:"#5a7a9a",letterSpacing:1,marginBottom:6,fontWeight:700}}>RECENT TRADES</div>
          {live.recent_trades.slice(0,6).map((t,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"3px 0",fontSize:11,borderBottom:"1px solid #0a1018"}}>
            <span style={{color:t.side==="BUY"?"#00f5a0":"#f54242",fontWeight:700,width:30}}>{t.side}</span>
            <span style={{color:"#8a9bb5",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",margin:"0 8px"}}>{t.title?.slice(0,40)}</span>
            <span className="mono" style={{color:"#5a7a9a",width:50,textAlign:"right"}}>${t.notional}</span>
          </div>)}</div>}
      </>}
    </div>}
  </div>
}

function MktCard({m}){
  const gap=m.price_gap,div=m.divergence;
  const dc={YES:{c:"#00f5a0",a:"\u25b2",label:"YES"},NO:{c:"#f54242",a:"\u25bc",label:"NO"},SPLIT:{c:"#5a7a9a",a:"\u25c6",label:"SPLIT"}}[m.smart_direction]||{c:"#5a7a9a",a:"?",label:"?"};
  const totalSharps=m.sharp_yes_count+m.sharp_no_count;
  const gapAbs=Math.abs(gap);
  // Signal strength: strong if high divergence + big gap + many sharps
  const strong=div>=.3&&gapAbs>=.08&&totalSharps>=3;
  const moderate=div>=.15||gapAbs>=.05||totalSharps>=2;
  const borderColor=strong?"#f5424440":moderate?"#f5c84225":"#1a2a3a";

  return <div style={{background:"#0a1018",border:`1px solid ${borderColor}`,borderRadius:8,padding:14,transition:"border-color .2s"}}>
    {/* Header: Question + Smart Money Direction */}
    <div style={{marginBottom:10}}>
      <div style={{fontSize:13,fontWeight:600,color:"#e8edf2",lineHeight:1.4,marginBottom:6}}>{CE[m.category]||"\ud83d\udcca"} {m.question?.slice(0,70)}</div>
      <div style={{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}}>
        <div style={{background:dc.c+"18",color:dc.c,padding:"4px 10px",borderRadius:5,fontSize:14,fontWeight:800,fontFamily:"'JetBrains Mono',monospace"}}>
          {dc.a} Smart Money: {dc.label} {(m.smart_money_yes_pct*100).toFixed(0)}%
        </div>
        <span style={{fontSize:11,color:"#5a7a9a"}}>Mkt Price: {(m.market_price*100).toFixed(0)}%</span>
        {gapAbs>=.05&&<span style={{fontSize:11,color:gapAbs>=.1?"#f5c842":"#a855f7",fontWeight:600}}>
          {gap>0?"\u25b2 Underpriced":"\u25bc Overpriced"} by {(gapAbs*100).toFixed(0)}%
        </span>}
      </div>
    </div>

    {/* Sharp vs Dull bars */}
    <div style={{marginBottom:6}}>
      <div style={{display:"flex",justifyContent:"space-between",fontSize:9,color:"#5a7a9a",marginBottom:2}}>
        <span>SHARP ({totalSharps} wallets) &mdash; ${(m.sharp_yes_notional+m.sharp_no_notional).toLocaleString("en",{maximumFractionDigits:0})} total</span>
        <span style={{color:dc.c}}>{(m.smart_money_yes_pct*100).toFixed(0)}% YES</span></div>
      <Bar pct={m.smart_money_yes_pct} h={7}/>
    </div>
    <div style={{marginBottom:8}}>
      <div style={{display:"flex",justifyContent:"space-between",fontSize:9,color:"#3a4a5a",marginBottom:2}}>
        <span>DULL ({m.dull_yes_count+m.dull_no_count} wallets)</span>
        <span>{(m.dull_money_yes_pct*100).toFixed(0)}% YES</span></div>
      <Bar pct={m.dull_money_yes_pct} h={5} o={.4}/>
    </div>

    {/* Bottom signal badges */}
    <div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}>
      {div>=.3&&<span style={{background:"rgba(245,66,66,.15)",color:"#f54242",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700}}>{"\u26a1"} Sharp &amp; Dull Disagree ({(div*100).toFixed(0)}%)</span>}
      {div>=.15&&div<.3&&<span style={{background:"rgba(245,200,66,.1)",color:"#f5c842",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:600}}>Mild Divergence ({(div*100).toFixed(0)}%)</span>}
      {strong&&<span style={{background:"rgba(168,85,247,.15)",color:"#a855f7",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700}}>{"\ud83c\udfaf"} Strong Signal</span>}
      <span style={{fontSize:10,color:"#3a4a5a",marginLeft:"auto"}}>Vol: ${m.volume?.toLocaleString("en",{maximumFractionDigits:0})}</span>
    </div>
  </div>
}

function App(){
  const[tab,setTab]=useState("dashboard");
  const[wF,setWF]=useState("all");
  const[wS,setWS]=useState("sharpness");
  const stats=useApi("/api/stats",5000);
  const wD=useApi("/api/wallets?limit=200",60000);
  const cD=useApi("/api/convergence",60000);
  const mD=useApi("/api/markets?limit=50",60000);
  const wallets=wD?.wallets||[],signals=cD?.signals||[],markets=mD?.markets||[];
  const tiers=stats?.tiers||{};
  const fw=wF==="all"?wallets:wallets.filter(w=>w.tier===wF);
  const sk={sharpness:"sharpness_score",pnl:"total_pnl",clv:"avg_clv",winrate:"win_rate",markets:"distinct_markets"};
  const sw=[...fw].sort((a,b)=>(b[sk[wS]]||0)-(a[sk[wS]]||0));

  const Btn=({id,label})=><button onClick={()=>setTab(id)} style={{background:tab===id?"#1a2a3a":"transparent",color:tab===id?"#e8edf2":"#5a7a9a",border:`1px solid ${tab===id?"#2a3a4a":"transparent"}`,borderRadius:6,padding:"6px 14px",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"}}>{label}</button>;
  const FB=({v,l,set,cur})=><button onClick={()=>set(v)} style={{background:cur===v?"#1a2a3a":"transparent",color:cur===v?"#e8edf2":"#5a7a9a",border:`1px solid ${cur===v?"#2a3a4a":"transparent"}`,borderRadius:4,padding:"3px 8px",fontSize:10,cursor:"pointer",fontFamily:"'DM Sans',sans-serif",textTransform:"uppercase"}}>{l}</button>;

  const WH=<div style={{display:"grid",gridTemplateColumns:"36px 1fr 80px 52px 60px 52px 70px",padding:"8px",borderBottom:"2px solid #1a2a3a"}}>
    {["#","Wallet","Score","CLV","Win%","Mkts","PnL"].map((h,i)=><span key={i} style={{fontSize:9,fontWeight:700,color:"#3a4a5a",letterSpacing:1.5,textTransform:"uppercase",textAlign:i>1?"right":"left"}}>{h}</span>)}</div>;

  return <div style={{maxWidth:1200,margin:"0 auto",padding:"16px 16px 40px"}}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:10}}>
      <div>
        <h1 className="mono" style={{fontSize:20,fontWeight:800,color:"#e8edf2",letterSpacing:-.5}}>SHARPFLOW</h1>
        <div style={{fontSize:11,color:"#3a4a5a",marginTop:2}}>Polymarket Smart Money Intelligence</div>
      </div>
      <div style={{display:"flex",alignItems:"center",gap:8}}>
        {stats?.status==="ready"?<span style={{fontSize:10,color:"#00f5a0"}}>{"\u25cf"} Live</span>:
         stats?.status==="running"?<span style={{fontSize:10,color:"#f5c842",animation:"pulse 1.5s infinite"}}>{"\u25cf"} {stats?.progress||"Refreshing..."}</span>:
         <span style={{fontSize:10,color:"#f54242"}}>{"\u25cf"} {stats?.status||"Loading"}</span>}
        <span style={{fontSize:10,color:"#2a3a4a"}}>{stats?.last_refresh?new Date(stats.last_refresh+"Z").toLocaleTimeString():""}</span>
      </div>
    </div>

    <div style={{display:"flex",gap:4,marginBottom:16}}>
      <Btn id="dashboard" label="Dashboard"/>
      <Btn id="markets" label={`Markets${markets.length?` (${markets.length})`:""}`}/>
      <Btn id="wallets" label={`Wallets${wallets.length?` (${wallets.length})`:""}`}/>
    </div>

    {tab==="dashboard"&&<div style={{animation:"fadeIn .2s ease"}}>
      <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(95px,1fr))",gap:8,marginBottom:20}}>
        <Stat value={stats?.wallets_scored||0} label="Wallets"/>
        <Stat value={tiers.sharp||0} label="Sharp" color="#00f5a0"/>
        <Stat value={tiers.sharp||0} label="Sharp" color="#f5c842"/>
        <Stat value={signals.length} label="Convergence" color="#a855f7"/>
        <Stat value={markets.length} label="Mkts Tracked" color="#f5c842"/>
        <Stat value={stats?.markets_analyzed||0} label="Analyzed" color="#5a7a9a"/>
      </div>
      {signals.length>0&&<div style={{marginBottom:20}}>
        <h2 style={{fontSize:13,fontWeight:700,color:"#a855f7",marginBottom:8,letterSpacing:1}}>{"\ud83c\udfaf"} CONVERGENCE SIGNALS</h2>
        {signals.slice(0,5).map((s,i)=><div key={i} style={{background:"#0a1018",border:"1px solid #1a2a3a",borderRadius:6,padding:12,marginBottom:6,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div style={{flex:1}}><div style={{fontSize:13,color:"#e8edf2",fontWeight:600}}>{s.market_title?.slice(0,60)}</div>
            <div style={{fontSize:10,color:"#3a4a5a",marginTop:2}}>{s.wallet_count} wallets ({s.elite_count}{"\u26a1"}) &middot; Strength: {s.strength?.toFixed(2)}</div></div>
          <div style={{fontWeight:800,fontSize:16,color:s.side==="YES"?"#00f5a0":"#f54242"}}>{s.side}</div></div>)}
      </div>}
      <div style={{marginBottom:20}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
          <h2 style={{fontSize:13,fontWeight:700,color:"#f5c842",letterSpacing:1}}>{"\ud83d\udcca"} HOT MARKETS</h2>
          <button onClick={()=>setTab("markets")} style={{background:"none",border:"none",color:"#a855f7",fontSize:11,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"}}>View all &rarr;</button>
        </div>
        <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(300px,1fr))",gap:8}}>
          {markets.slice(0,6).map((m,i)=><MktCard key={i} m={m}/>)}
        </div>
        {!markets.length&&<div style={{background:"#0a1018",border:"1px solid #1a2a3a",borderRadius:8,padding:20,textAlign:"center",color:"#3a4a5a",fontSize:12}}>Market intel appears after pipeline run</div>}
      </div>
      <div>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
          <h2 style={{fontSize:13,fontWeight:700,color:"#00d4ff",letterSpacing:1}}>{"\ud83d\udc5b"} TOP WALLETS</h2>
          <button onClick={()=>setTab("wallets")} style={{background:"none",border:"none",color:"#a855f7",fontSize:11,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"}}>View all &rarr;</button>
        </div>
        <div style={{background:"#0a1018",border:"1px solid #1a2a3a",borderRadius:8,overflow:"hidden"}}>
          {WH}{wallets.slice(0,15).map((w,i)=><WalletRow key={w.wallet} w={w} rank={i+1}/>)}
        </div>
      </div>
    </div>}

    {tab==="markets"&&<div style={{animation:"fadeIn .2s ease"}}>
      <div style={{background:"#0a1018",border:"1px solid #1a2a3a",borderRadius:8,padding:12,marginBottom:16,fontSize:11,color:"#5a7a9a",lineHeight:1.6}}>
        <b style={{color:"#e8edf2"}}>How to read:</b> <span style={{color:"#00f5a0"}}>Green</span> = sharp money YES, <span style={{color:"#f54242"}}>red</span> = NO. <b>Price Gap</b> = market vs smart money. <b style={{color:"#f54242"}}>Divergence</b> = sharp &amp; dull disagree.</div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(340px,1fr))",gap:10}}>
        {markets.map((m,i)=><MktCard key={i} m={m}/>)}
      </div>
      {!markets.length&&<div style={{textAlign:"center",color:"#3a4a5a",padding:40}}>No market intel yet.</div>}
    </div>}

    {tab==="wallets"&&<div style={{animation:"fadeIn .2s ease"}}>
      <div style={{display:"flex",gap:6,marginBottom:12,flexWrap:"wrap",alignItems:"center"}}>
        <span style={{fontSize:10,color:"#3a4a5a",marginRight:4}}>TIER:</span>
        <FB v="all" l={`All (${wallets.length})`} set={setWF} cur={wF}/>
        {["sharp","average","dull"].map(f=><FB key={f} v={f} l={`${f} (${wallets.filter(w=>w.tier===f).length})`} set={setWF} cur={wF}/>)}
        <span style={{fontSize:10,color:"#3a4a5a",marginLeft:12,marginRight:4}}>SORT:</span>
        {["sharpness","pnl","clv","winrate","markets"].map(s=><FB key={s} v={s} l={s} set={setWS} cur={wS}/>)}
      </div>
      <div style={{background:"#0a1018",border:"1px solid #1a2a3a",borderRadius:8,overflow:"hidden"}}>
        {WH}{sw.map((w,i)=><WalletRow key={w.wallet} w={w} rank={i+1}/>)}
        {!sw.length&&<div style={{padding:20,textAlign:"center",color:"#3a4a5a"}}>No wallets match</div>}
      </div>
    </div>}

    <div style={{marginTop:30,padding:16,textAlign:"center",fontSize:10,color:"#1a2a3a",borderTop:"1px solid #111b26"}}>
      SharpFlow v1.6 &middot; Not financial advice</div>
  </div>
}
ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body></html>
